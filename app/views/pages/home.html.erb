<div class="container py-5">
  <div class="row mb-4">
    <div class="col-12 text-center">
      <h1 class="display-4 mb-3">Dashboard</h1>
      <p class="lead">Welcome back! Hereâ€™s a quick overview of your application.</p>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <i class="bi bi-person-lines-fill display-4 text-primary mb-2"></i>
          <h5 class="card-title">Profile</h5>
          <p class="card-text">View and edit your user profile and account settings.</p>
          <%= link_to 'Profile', user_path(current_user), class: 'btn btn-outline-primary btn-sm' if current_user %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <i class="bi bi-file-earmark-text display-4 text-success mb-2"></i>
          <h5 class="card-title">Loans</h5>
          <p class="card-text">Create, view, and manage your blog posts.</p>
          <%= link_to 'Loans', posts_path, class: 'btn btn-outline-success btn-sm' %>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <i class="bi bi-info-circle display-4 text-warning mb-2"></i>
          <h5 class="card-title">About</h5>
          <p class="card-text">Learn more about this application and its features.</p>
          <%= link_to 'About', about_path, class: 'btn btn-outline-warning btn-sm' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Total Loans</h6>
          <h2><%= Post.count %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Total Users</h6>
          <h2><%= User.count %></h2>
        </div>
      </div>
    </div>


  <!-- Table of Recent Posts -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0">Recent Loans</h5>
        </div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Loans</th>
                <th>User</th>
                <th>Views</th>
                <th>Created</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% Post.order(created_at: :desc).limit(5).each do |post| %>
                <tr>
                  <td><%= post.amount %></td>
                  <td><%= post.user&.email || "Unknown" %></td>
                  <td><%= post.views || 0 %></td>
                  <td><%= post.created_at.strftime("%b %d, %Y") %></td>
                  <td>
                    <%= link_to 'Show', post_path(post), class: "btn btn-sm btn-outline-primary" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Example Graph (Chart.js) -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0">Loans Created (Last 7 Days)</h5>
        </div>
        <div class="card-body">
          <canvas id="postsChart" height="80"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <div class="card border-0 bg-light shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Credit Cards</h5>
          <p class="card-text">Manage your saved credit cards securely.</p>
          <%= link_to 'Credit Cards', credit_cards_path, class: 'btn btn-outline-dark btn-sm' %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js Script (add Chart.js to your layout or asset pipeline for this to work) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var ctx = document.getElementById('postsChart').getContext('2d');
    var postsData = <%= raw(
      (0..6).map { |i|
        Post.where(created_at: (Date.today - i).all_day).count
      }.reverse.to_json
    ) %>;
    var postsLabels = <%= raw(
      (0..6).map { |i|
        (Date.today - i).strftime("%a")
      }.reverse.to_json
    ) %>;
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: postsLabels,
        datasets: [{
          label: 'Posts',
          data: postsData,
          backgroundColor: 'rgba(13,110,253,0.1)',
          borderColor: 'rgba(13,110,253,1)',
          borderWidth: 2,
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointBackgroundColor: 'rgba(13,110,253,1)'
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, precision: 0 }
        }
      }
    });
  });
</script>